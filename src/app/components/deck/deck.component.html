<div
  style="margin: 2em 2em 0 2em"
  [ngStyle]="{ height: listExpanded ? '14%' : '47%' }"
>
  <span fxLayout="row" style="height: 60px">
    <mtg-mana
      *ngIf="deck!.colors !== Colors.NONE"
      [symbol]="deck!.colors"
      [colorIndicator]="true"
      [size]="'2x'"
      style="padding-top: 4px; padding-right: 8px"
    ></mtg-mana>
    <h1>{{ deck!.name }}</h1>
    <mat-icon
      style="color: gray; padding-top: 8px"
      (click)="toggleSettingsExpanded()"
    >
      {{ settingsExpanded ? "chevron_right" : "expand_more" }}</mat-icon
    >
    <span *ngIf="settingsExpanded" fxLayout="row">
      <form [formGroup]="settingsGroup">
        <mat-form-field style="padding-left: 10px">
          <mat-select matSelect formControlName="format">
            <mat-option *ngFor="let format of formatArray" [value]="format">{{
              format
            }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field style="padding-left: 10px">
          <mat-select matSelect formControlName="colors">
            <mat-option *ngFor="let color of colorsArray" [value]="color">
              <span fxLayout="row"
                ><mtg-mana
                  [symbol]="color"
                  [colorIndicator]="true"
                  style="padding-right: 10px"
                ></mtg-mana
                >{{ color }}</span
              ></mat-option
            >
          </mat-select>
        </mat-form-field>
        <mat-checkbox
          color="primary"
          matCheckbox
          style="padding-left: 10px"
          formControlName="isActive"
          >Is active</mat-checkbox
        >
      </form>
      <button
        mat-icon-button
        color="warn"
        (click)="removeDeck()"
        style="padding-top: 5px"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </span>
    <span class="flex"></span>
    <mat-chip-list style="position: absolute; right: 2em">
      <mat-chip
        [disableRipple]="true"
        style="
          background-color: #173b30;
          color: #1baf44;
          border-style: solid;
          border-width: 1px;
        "
        *ngIf="deck!.playable"
        >Playable</mat-chip
      >
      <mat-chip
        [disableRipple]="true"
        style="
          background-color: #392029;
          color: #eb8776;
          border-style: solid;
          border-width: 1px;
        "
        *ngIf="!deck!.playable"
        >Needs fixing</mat-chip
      >
    </mat-chip-list>
  </span>
  <mat-card
    fxLayout="row"
    style="height: calc(100% - 60px); overflow-y: hidden; padding: 0"
  >
    <div class="detail">
      Cards (
      <span
        [ngStyle]="{
          color:
            amountOfCardsInDeck(deck!) <
            (currentFormat ? currentFormat.minCardAmount : 60)
              ? '#f44336'
              : 'white'
        }"
        >{{ amountOfCardsInDeck(deck!) }}</span
      >
      / {{ currentFormat ? currentFormat.minCardAmount : 60 }} )
      <div *ngIf="!listExpanded">
        <div style="padding-top: 10px">
          Sideboard (
          <span
            [ngStyle]="{
              color: deck!.sideboard.length > 15 ? '#f44336' : 'white'
            }"
            >{{ deck!.sideboard.length }}</span
          >
          / {{ currentFormat ? currentFormat.sideboardMaxCardAmount : 15 }} )
        </div>
        <div fxLayout="row">
          <div
            *ngIf="currentFormat?.hasCommander"
            style="position: absolute"
            [ngStyle]="{
              'z-index': hover === 'comm' ? 99 : 0
            }"
          >
            <div style="padding-top: 10px">
              Commander<span *ngIf="deck!.companion">/Companion</span>:
            </div>
            <div
              [matTooltip]="imageTooltip(this.deck!.commander)"
              [matTooltipShowDelay]="1000"
              matTooltipClass="fitToImage"
              style="padding-top: 10px"
            >
              <img
                [src]="this.deck!.commander?.image_uris?.small"
                style="border-radius: 6px"
                (mouseenter)="setHover('comm')"
              />
            </div>
          </div>
          <div
            *ngIf="deck!.companion"
            style="position: absolute"
            [ngStyle]="{
              'margin-left': currentFormat?.hasCommander ? '35px' : '',
              'z-index': hover === 'comp' ? 99 : 0
            }"
          >
            <div style="padding-top: 10px">
              <span *ngIf="currentFormat?.hasCommander">&nbsp;</span>
              <span *ngIf="!currentFormat?.hasCommander && deck!.companion">
                Companion:</span
              >
            </div>
            <div
              [matTooltip]="imageTooltip(this.deck!.companion)"
              [matTooltipShowDelay]="1000"
              matTooltipClass="fitToImage"
              style="padding-top: 10px"
            >
              <img
                src="https://c1.scryfall.com/file/scryfall-cards/small/front/5/a/5ad36fb2-c44e-4085-ba0d-54277841ad3a.jpg?1613387006"
                style="border-radius: 6px"
                (mouseenter)="setHover('comp')"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="detail">
      Problems (
      <span
        [ngStyle]="{
          color: deckValidation.amountOfProblems > 0 ? '#f44336' : '#1baf44'
        }"
        >{{ deckValidation.amountOfProblems }}
      </span>
      )
      <div *ngIf="!listExpanded && currentFormat">
        <div
          style="padding-top: 10px"
          *ngIf="deckValidation.hasLegalAmountOfCards"
        >
          <mat-icon style="color: #1baf44">check</mat-icon>
          <span class="problem-span"> Has valid amount of cards.</span>
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="!deckValidation.hasLegalAmountOfCards"
        >
          <mat-icon style="color: #f44336">clear</mat-icon>
          <span class="problem-span">
            {{ amountOfCardsInDeck(deck!) }} is not a valid amount of cards in
            {{ currentFormat ? formatArray[currentFormat.format] : 0 }}.</span
          >
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="deckValidation.hasLegalAmountOfCopiesOfCards"
        >
          <mat-icon style="color: #1baf44">check</mat-icon>
          <span class="problem-span">
            Has valid amount of copies of cards.</span
          >
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="!deckValidation.hasLegalAmountOfCopiesOfCards"
        >
          <mat-icon style="color: #f44336">clear</mat-icon>
          <span class="problem-span">
            Some cards exceed the copy limit of
            {{ currentFormat ? currentFormat.maxCopiesOfCards : 0 }} of
            {{ currentFormat ? formatArray[currentFormat.format] : 0 }}.</span
          >
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="deckValidation.hasNotMoreThanMaximumOfSideboardCards"
        >
          <mat-icon style="color: #1baf44">check</mat-icon>
          <span class="problem-span">
            Has valid amount of cards in sideboard.</span
          >
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="!deckValidation.hasNotMoreThanMaximumOfSideboardCards"
        >
          <mat-icon style="color: #f44336">clear</mat-icon>
          <span class="problem-span">
            {{ deck!.sideboard.length }} is not a valid amount of cards for a
            sideboard in
            {{ currentFormat ? formatArray[currentFormat.format] : 0 }}.</span
          >
        </div>
        <div style="padding-top: 10px" *ngIf="deckValidation.hasNoIllegalCards">
          <mat-icon style="color: #1baf44">check</mat-icon>
          <span class="problem-span">
            Every card in the deck is legal in
            {{ currentFormat ? formatArray[currentFormat.format] : 0 }}.</span
          >
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="!deckValidation.hasNoIllegalCards"
          [matTooltip]="cardsListToHTMLList(deckValidation.illegalCards)"
        >
          <mat-icon style="color: #f44336">clear</mat-icon>
          <span class="problem-span">
            {{ deckValidation.illegalCards.length }} of these cards are illegal
            in {{ formatArray[currentFormat.format] }}.
          </span>
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="
            currentFormat?.mustComplyToColorIdentity &&
            deckValidation.hasNoIllegalColorIdentities
          "
        >
          <mat-icon style="color: #1baf44">check</mat-icon>
          <span class="problem-span">
            Every card in the deck complies to the color rules of
            {{ formatArray[currentFormat.format] }}.</span
          >
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="
            currentFormat?.mustComplyToColorIdentity &&
            !deckValidation.hasNoIllegalColorIdentities
          "
          [matTooltip]="
            cardsListToHTMLList(deckValidation.illegalColorIdentities)
          "
        >
          <mat-icon style="color: #f44336">clear</mat-icon>
          <span class="problem-span">
            {{ deckValidation.illegalColorIdentities.length }} of these cards
            are illegal in {{ deck!.colors }}.
          </span>
        </div>
        <div style="padding-top: 10px" *ngIf="missingCards.length === 0">
          <mat-icon style="color: #1baf44">check</mat-icon>
          <span class="problem-span">
            You own enough copies of all of the cards in this deck.</span
          >
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="missingCards.length > 0"
          [matTooltip]="cardsListToHTMLList(missingCards)"
        >
          <mat-icon style="color: #f44336">clear</mat-icon>
          <span class="problem-span">
            You dont own enough copies of {{ missingCards.length }} of the cards
            included in this deck.
          </span>
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="currentFormat.hasCommander && !deckValidation.needsCommander"
        >
          <mat-icon style="color: #1baf44">check</mat-icon>
          <span class="problem-span"> A commander is assigned.</span>
        </div>
        <div
          style="padding-top: 10px"
          *ngIf="currentFormat.hasCommander && deckValidation.needsCommander"
        >
          <mat-icon style="color: #f44336">clear</mat-icon>
          <span class="problem-span"> You need to assign a commander. </span>
        </div>
      </div>
    </div>
    <div class="detail">
      Curve ( {{ parseCurveData() }} )
      <div *ngIf="!listExpanded">
        <apx-chart
          [series]="curveSeries"
          [chart]="curveChart"
          [legend]="curveLegend"
          [dataLabels]="curveLabels"
          [grid]="curveGrid"
          [tooltip]="curveTooltip"
          [xaxis]="curveXaxis"
          [yaxis]="curveYaxis"
        ></apx-chart>
      </div>
    </div>
    <div class="detail">
      Distribution ( {{ parseColorPieData() }} )
      <div style="padding-top: 10px" *ngIf="!listExpanded">
        <apx-chart
          [series]="distSeries"
          [chart]="distChart"
          [legend]="distLegend"
          [dataLabels]="distDataLabels"
          [stroke]="distStroke"
          [labels]="distLabels"
          [fill]="distFill"
          [tooltip]="distTooltip"
        ></apx-chart>
      </div>
      <div fxLayout="row" style="justify-content: center; margin-top: 5%">
        <button
          mat-button
          color="primary"
          (click)="setCurrentDist(Pies.COLORS)"
          [disabled]="distType === Pies.COLORS"
        >
          Colors
        </button>
        <span style="width: 2%"></span>
        <button
          mat-button
          color="primary"
          (click)="setCurrentDist(Pies.TYPES)"
          [disabled]="distType === Pies.TYPES"
        >
          Types
        </button>
      </div>
    </div>
  </mat-card>
</div>
<div fxLayout="row" style="height: 40px; min-height: 40px">
  <button
    mat-icon-button
    color="primary"
    (click)="toggleListExpanded()"
    style="margin-left: 2em"
  >
    <mat-icon>{{ !listExpanded ? "expand_less" : "expand_more" }}</mat-icon>
  </button>
  <div style="position: absolute; right: 2em">
    <mat-button-toggle-group
      name="listStyle"
      aria-label="List style"
      style="border: none"
    >
      <mat-button-toggle value="list" style="background-color: transparent"
        ><mat-icon color="primary"
          >format_align_justify</mat-icon
        ></mat-button-toggle
      >
      <mat-button-toggle value="detail" style="background-color: transparent"
        ><mat-icon color="primary"> view_module </mat-icon></mat-button-toggle
      >
    </mat-button-toggle-group>
  </div>
</div>
<mtg-cards-list
  [listType]="ListTypes.DECK"
  [deck]="deck"
  [format]="currentFormat"
  [deckValidation]="deckValidation"
  [missingCards]="missingCards"
  [ngStyle]="{ height: listExpanded ? '83%' : '50%' }"
  (rerender)="rerender()"
  [expanded]="listExpanded"
></mtg-cards-list>
